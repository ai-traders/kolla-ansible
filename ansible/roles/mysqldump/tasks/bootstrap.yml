---
- name: Create mysqldump container
  docker_container:
    restart_policy: "always"
    env:
      DB_DUMP_BEGIN: "{{ mysqldump_begin }}"
      DB_DUMP_TARGET: /os2-backup
      DB_SERVER: "{{ kolla_internal_vip_address }}"
      DBPORT: "{{ mariadb_port }}"
      DB_USER: "{{ database_user }}"
      DB_PASS: "{{ database_password }}"
    image: "{{ mysqldump_image_full }}"
    name: "backup_openstack2"
    network_mode: "host"
    volumes:
      - "/var/ait/scripts/openstack_backup_pre/:/scripts.d/pre-backup"
      - "/var/ait/scripts/openstack_backup_post/:/scripts.d/post-backup"
      - "/etc/localtime:/etc/localtime:ro"
      - "/backup/{{ ait_environment }}/local/openstack2:/os2-backup"
      - "/backup/{{ ait_environment }}/workspace/backup_openstack2:/tmp/backups"
